<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="account_move_form_view_inherited_guia" model="ir.ui.view">
    <field name="name">account.move.view.form.inherit.guia</field>
    <field name="model">account.move</field>
    <field name="inherit_id" ref="l10n_pe_edi_odoofact.view_move_form"/>
    <field name="arch" type="xml">

      <xpath expr="//group[@name='reference_guides_group']" position="replace">
        <group string="Reference Guides" name="reference_guides_group"
               invisible="move_type not in ('out_invoice','out_refund','in_invoice','in_refund')">

          <field name="stock_picking_ids"
                 nolabel="1"
                 colspan="2"
                 readonly="state != 'draft'"
                 widget="many2many"
                 context="{'tree_view_ref': 'module_name.stock_picking_gre_tree_view'}"
                 domain="[
                    ('company_id','=',company_id),
                    ('gre_doc_name','!=',False),
                    ('gre_doc_name','not in',['',False,' ']),
                    '|',
                        ('gre_account_move_id','=',False),
                        ('gre_account_move_id','=', id)
                 ]">
            <tree>
              <field name="gre_doc_name"/>
              <field name="name"/>
              <field name="partner_id"/>
              <field name="scheduled_date"/>
            </tree>
          </field>
        </group>
      </xpath>

    </field>
  </record>

  <!-- Vista tree específica para mostrar gre_doc_name en el selector -->
  <record id="stock_picking_gre_tree_view" model="ir.ui.view">
    <field name="name">stock.picking.gre.tree</field>
    <field name="model">stock.picking</field>
    <field name="arch" type="xml">
      <tree>
        <field name="gre_doc_name" string="Guía de Remisión"/>
        <field name="name" string="Transferencia"/>
        <field name="partner_id"/>
        <field name="scheduled_date"/>
      </tree>
    </field>
  </record>

</odoo>